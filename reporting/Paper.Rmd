---
title: "IMDb Runtime & Ratings Analysis (2011–2020)"
author: "Group 7"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    number_sections: true
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)

library(dplyr)
library(tidyr)
library(readr)
library(knitr)
library(here)
```

## Introduction

We studied whether movie runtime is associated with IMDb ratings, and
whether this relationship differs by genre (Comedy, Action, Adventure)
and period (2011–2015 vs. 2016–2020). We worked with IMDb movie data and
by:

-   Filtering the dataset (only movies with a runtime of over 30 minutes
    and rated by more than 50 votes),

-   Checking for missing runtimes and testing whether missingness was
    random,

-   Creating descriptive statistics and visualizations to show trends,

-   Running an OLS regression with interactions to study how runtime,
    genre, and year relate to IMDb ratings.

## Methods

We began with a descriptive analysis to explore the data. This included
examining trends over time, looking at the distributions of ratings,
votes (on a log scale), and runtimes, and summarizing results by both
year and genre (focusing on Action, Comedy, and Adventure). We conducted
the analysis in two steps:

-   **Descriptive analysis:**\
    We first explored the data by examining trends over time, the
    distributions of IMDb ratings, votes (on a log scale), and runtimes,
    and summary statistics by both year and genre (Action, Comedy, and
    Adventure).

-   **Regression analysis:**\
    We then estimated an ordinary least squares (OLS) regression with
    interaction terms to test whether a film’s runtime influences its
    IMDb rating, and whether this relationship differs by genre and
    release period. Runtime was treated as a continuous predictor,
    scaled in 10-minute units (`Runtime10`), IMDb rating was the
    continuous outcome, and the two moderators were Genre (`Comedy`,
    `Adventure`, `Action`) and Release Period (`2011–2015` vs.
    `2016–2020`).

    To control for rating stability, we included the number of IMDb
    votes (log₁₀-transformed) as a covariate. Robust HC3 standard errors
    were used to account for heteroskedasticity, and we checked
    diagnostics including heteroskedasticity tests, residual normality,
    and variance inflation factors (VIF).

The regression model can be written as:

$$
\text{Rating} = \beta_0 + \beta_1 \cdot \text{Runtime10} + \beta_2 \cdot \text{Adventure} + \beta_3 \cdot \text{Action} + \beta_4 \cdot \text{YearGroup}_{2016–2020} 
+ \beta_5 \cdot (\text{Runtime10} \times \text{Adventure}) +$$

$$\beta_6 \cdot (\text{Runtime10} \times \text{Action}) + \beta_7 \cdot (\text{Runtime10} \times \text{YearGroup}_{2016–2020}) + \beta_8 \cdot \log_{10}(\text{Votes}) + \epsilon
$$

## Descriptive Results

```{r descriptive-tables, echo=FALSE, message=FALSE, warning=FALSE}
# 1) Load data (rename to avoid clashing with stats::df) 
movies <- readr::read_csv(here::here("gen", "output", "final_dataset.csv"),
                          show_col_types = FALSE)

# 2) Genre summary (multi-label expanded; only Action/Comedy/Adventure)
genre_tbl <- movies %>%
  tidyr::separate_rows(genres, sep = ",") %>%
  dplyr::filter(genres %in% c("Action","Comedy","Adventure")) %>%
  dplyr::group_by(genres) %>%
  dplyr::summarise(
    n_films      = dplyr::n(),
    mean_rating  = mean(averageRating, na.rm = TRUE),
    sd_rating    = sd(averageRating, na.rm = TRUE),
    mean_votes   = mean(numVotes, na.rm = TRUE),
    mean_runtime = mean(runtimeMinutes, na.rm = TRUE),
    .groups = "drop"
  )

knitr::kable(genre_tbl, digits = 2, caption = "Summary by Genre")

# 3) Year summary
year_tbl <- movies %>%
  dplyr::group_by(startYear) %>%
  dplyr::summarise(
    n_films      = dplyr::n(),
    mean_rating  = mean(averageRating, na.rm = TRUE),
    mean_votes   = mean(numVotes, na.rm = TRUE),
    mean_runtime = mean(runtimeMinutes, na.rm = TRUE),
    .groups = "drop"
  )

knitr::kable(year_tbl, digits = 2, caption = "Summary by Year")
```

## Descriptive figures

#3 Ratings were fairly stable over time, with a slight downward trend
after 2017.

```{r fig-avgrating-year, echo=FALSE, out.width="60%"}
knitr::include_graphics(here::here("gen","output","desc-analysis-figures","avgrating_per_year.png"))
```

<br><br> #6 Runtimes were concentrated between 80–120 minutes, with some
outliers representing very short or very long films.

```{r fig-votes-log, echo=FALSE, out.width="60%"}
knitr::include_graphics(here::here("gen","output","desc-analysis-figures","logdist_of_votes.png"))
```

<br><br> #10 Action films generally had the longest runtimes, followed
by Adventure, while Comedies tended to be shorter on average.

```{r fig-heatmap-rating, echo=FALSE, out.width="60%"}
knitr::include_graphics(here::here("gen","output","desc-analysis-figures","heatmap_of_averagerating_per_year.png"))
```

<br><br> #2 The number of films released annually increased until around
2018, with a small decline in 2019–2020.

```{r fig-films-year, echo=FALSE, out.width="60%"}
knitr::include_graphics(here::here("gen","output","desc-analysis-figures","films_per_year.png"))
```

<br><br> #5

```{r fig-avgrating-genre, echo=FALSE, out.width="60%"}
knitr::include_graphics(here::here("gen","output","desc-analysis-figures","avgrating_per_genre.png"))
```

<br><br> #1

```{r fig-avgruntime, echo=FALSE, out.width="60%"}
knitr::include_graphics(here::here("gen","output","desc-analysis-figures","avgruntime_per_year.png"))
```

<br><br> #8

```{r fig-dist-runtime, echo=FALSE, out.width="60%"}
knitr::include_graphics(here::here("gen","output","desc-analysis-figures","dist_of_runtimes.png"))
```

<br><br> #4

```{r fig-dist-ratings, echo=FALSE, out.width="60%"}
knitr::include_graphics(here::here("gen","output","desc-analysis-figures","dist_of_ratings.png"))
```

<br><br> #9

```{r fig-runtime-genre, echo=FALSE, out.width="60%"}
knitr::include_graphics(here::here("gen","output","desc-analysis-figures","runtimedist_by_genre.png"))
```

<br><br> #7

```{r fig-avgvotes-genre, echo=FALSE, out.width="60%"}
knitr::include_graphics(here::here("gen","output","desc-analysis-figures","avgvotes_per_genre.png"))
```

<br><br>
